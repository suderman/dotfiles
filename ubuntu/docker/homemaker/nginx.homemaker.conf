# Homemaker

# Internet HTTP (redirect)
server {
  listen      8000;
  server_name api.$DOMAIN;
  rewrite     ^ https://$server_name$request_uri? permanent;
}

# Internet HTTPS
server {
  listen      4430 ssl;
  server_name api.$DOMAIN;

  # Enable Stapling
  ssl_stapling            on;
  ssl_stapling_verify     on;

  # Client certificate authentication
  set $authorized_common_name $DOMAIN;
  set $unauthorized_redirect http://ca.$DOMAIN;
  include /config/verify_client.conf;

  location / {
    proxy_pass http://$HOST_IP:7000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}

# Local HTTP/HTTPS
server {
  listen      80;
  listen      443 ssl;
  server_name api.$DOMAIN api.lan;

  location / {
    proxy_pass http://$HOST_IP:7000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}


# Homemaker Database

# Internet HTTP (redirect)
server {
  listen      8000;
  server_name apidb.$DOMAIN;
  rewrite     ^ https://$server_name$request_uri? permanent;
}

# Internet HTTPS
server {
  listen      4430 ssl;
  server_name apidb.$DOMAIN;

  # Enable Stapling
  ssl_stapling            on;
  ssl_stapling_verify     on;

  # Client certificate authentication
  set $authorized_common_name $DOMAIN;
  set $unauthorized_redirect http://ca.$DOMAIN;
  include /config/verify_client.conf;

  location / {
    proxy_pass http://$HOST_IP:7001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}

# Local HTTP/HTTPS
server {
  listen      80;
  listen      443 ssl;
  server_name apidb.$DOMAIN apidb.lan;

  location / {
    proxy_pass http://$HOST_IP:7001;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}






# Dev Homemaker

# Internet HTTP (redirect)
server {
  listen      8000;
  server_name dev-api.$DOMAIN;
  rewrite     ^ https://$server_name$request_uri? permanent;
}

# Internet HTTPS
server {
  listen      4430 ssl;
  server_name dev-api.$DOMAIN;

  # Enable Stapling
  ssl_stapling            on;
  ssl_stapling_verify     on;

  # Client certificate authentication
  set $authorized_common_name $DOMAIN;
  set $unauthorized_redirect http://ca.$DOMAIN;
  include /config/verify_client.conf;

  location / {
    proxy_pass http://$HOST_IP:5005;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}

# Local HTTP/HTTPS
server {
  listen      80;
  listen      443 ssl;
  server_name dev-api.$DOMAIN dev-api.lan;

  location / {
    proxy_pass http://$HOST_IP:5005;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}


# Dev Homemaker Database

# Internet HTTP (redirect)
server {
  listen      8000;
  server_name dev-apidb.$DOMAIN;
  rewrite     ^ https://$server_name$request_uri? permanent;
}

# Internet HTTPS
server {
  listen      4430 ssl;
  server_name dev-apidb.$DOMAIN;

  # Enable Stapling
  ssl_stapling            on;
  ssl_stapling_verify     on;

  # Client certificate authentication
  set $authorized_common_name $DOMAIN;
  set $unauthorized_redirect http://ca.$DOMAIN;
  include /config/verify_client.conf;

  location / {
    proxy_pass http://$HOST_IP:5006;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}

# Local HTTP/HTTPS
server {
  listen      80;
  listen      443 ssl;
  server_name dev-apidb.$DOMAIN dev-apidb.lan;

  location / {
    proxy_pass http://$HOST_IP:5006;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    include /config/proxy_params.conf;
  }
}

