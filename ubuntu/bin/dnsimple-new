#!/bin/bash

# 2015 Jon Suderman
# https://github.com/suderman/local

# DNSIMPLE="email@example.com:foobar123example"
# DOMAIN="myserver.com"
# SUBDOMAIN="cool-new-service"


SUBDOMAIN="$1"
ROUTER="rt.$DOMAIN"

if [ -z "$SUBDOMAIN" ]; then
  echo "Missing subdomain"
  exit
fi

curl  -H "X-DNSimple-Token: $DNSIMPLE" \
      -H 'Accept: application/json' \
      -H 'Content-Type: application/json' \
      -X POST \
      -d "{ \"record\": { \"name\": \"$SUBDOMAIN\", \"record_type\": \"ALIAS\", \"content\": \"$ROUTER\", \"ttl\": 600 } }" \
      https://api.dnsimple.com/v1/domains/$DOMAIN/records \
      -s > /dev/null

echo "$SUBDOMAIN.$DOMAIN -> $ROUTER"
