#!/bin/bash

# 2015 Jon Suderman
# https://github.com/suderman/local

# DNSIMPLE="email@example.com:foobar123example"
# DOMAIN="myserver.com"

# Prevent IP from being updated to something outside home network
if [[ `hostname` != "nuc" ]]; then
  echo "Command must be run on nuc"
  exit
fi

# Update router.$DOMAIN to value of $IP
IP="`curl -s http://icanhazip.com/`"
ROUTER="router.$DOMAIN"

curl  -H "X-DNSimple-Token: $DNSIMPLE" \
      -H 'Accept: application/json' \
      -H 'Content-Type: application/json' \
      -X PUT \
      -d "{\"record\":{\"content\":\"$IP\"}}" \
      https://api.dnsimple.com/v1/domains/$DOMAIN/records/$ROUTER \
      -s > /dev/null

echo "$ROUTER -> $IP"

