#!/bin/bash

# 2015 Jon Suderman
# https://github.com/suderman/local

# Helper methods for prettier shell scripting - http://suderman.github.io/shelper
eval "$(cat ~/.local/share/shelper.sh || curl suderman.github.io/shelper/shelper.sh)"

# Don't ask questions, just install/update everything 
answer="ask"; if [ "$1" == "y" ]; then answer="y"; fi

# Handy template for installing
installing() { msg "Installing $(cyan "$1")..."; }

# Run init only if this script is called direct
if [ "$2" != "skip-init" ]; then init "$answer" skip-update; fi


# What I need to get going on OS X
# --------------------------------

# Install script starts here!
msg "Keeping OS X up to snuff..."

# Verify xcode
r="$(pkgutil --pkg-info=com.apple.pkg.CLTools_Executables 2>/dev/null | grep -v version)"
if [ "$r" == '' ]; then
  installing "xcode"
  echo "Xcode Coommand Line Tools needed. Installing now"
  xcode-select --install
  exit 1
fi

# Install launchup to manage launchd plists
if hasnt launchup; then
  installing "launchdn and launchup"
  curl -sS suderman.github.io/launchup/install | sh
fi
msg "Running launchdn and launchup"
launchdn && launchup

# Symlinking ~/.mackup.cfg
msg "Symlinking ~/.mackup.cfg"
has ~/.local/osx/mackup.$(hostname).cfg && ln -sf ~/.local/osx/mackup.$(hostname).cfg ~/.mackup.cfg

# osx & app help install OS X apps
has osx || curl https://raw.githubusercontent.com/suderman/osx/master/install.sh | sh
has app || curl https://raw.githubusercontent.com/suderman/app/master/install.sh | sh

# Install node & npm
if hasnt node; then
  installing "nodejs and npm"
  curl -sS suderman.github.io/install/node | sh
fi

# Install MySQL
if hasnt mysql; then
  installing "mysql"
  curl -sS suderman.github.io/install/mysql | sh
fi

# # Install packages
# if ask "Do you want to install $(cyan "Homebrew, Node, Python and Ruby packages") on this computer?"; then
#
#   msg "Updating packages in Brewfile"
#   brew bundle ~/.local/osx/Brewfile
#
#   msg "Updating packages in Npmfile"
#   npm-bundle ~/.local/osx/Npmfile
#
#   msg "Updating packages in Pipfile"
#   pip install -r ~/.local/osx/Pipfile
#
#   msg "Updating packages in Gemfile"
#   cd ~/.local/osx && bundle install
# fi

msg "...done!"

