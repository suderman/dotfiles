#!/bin/bash

# 2015 Jon Suderman
# https://github.com/suderman/local

# Open a terminal and run this command:
# bash <(curl https://raw.githubusercontent.com/suderman/local/master/bin/init)

# Helper methods for prettier shell scripting - http://suderman.github.io/shelper
eval "$(cat ~/.local/share/shelper.sh || curl suderman.github.io/shelper/shelper.sh)"

# Don't ask questions, just install/update everything 
answer="ask"; if [ "$1" == "y" ]; then answer="y"; fi

# Handy template for installing
installing() { msg "Installing $(cyan "$1")..."; }


# What I need to get going
# ------------------------

# Install script starts here!
msg "Keeping this computer up to snuff..."

# Ensure git & git-clone-pull exists
if hasnt git-clone-pull; then
  installing "git and git-clone-pull"
  curl -sS suderman.github.io/git-clone-pull/install | sh
fi

# Git clone/pull this repo to the home directory
installing "~/.local"
git clone-pull https://github.com/suderman/local.git ~/.local

# Symlink private repo if available
if has ~/.private/local; then
  rm ~/.local/private && ln -s ~/.private/local ~/.local/private
fi

# Install rcm to manage the dotfiles
if hasnt rcup; then
  installing "rcm"
  curl -sS suderman.github.io/install/rcm | sh
fi

# Ensure the .rcrc file exists before rcup is run at all
msg "Copying ~/.rcrc and running rcup"
cp -f ~/.local/dotfiles/rcrc ~/.rcrc
rcup

# Install Bash it
installing "~/.bash_it"
git clone-pull https://github.com/Bash-it/bash-it.git ~/.bash_it

# Install Liquid Prompt 
installing "~/.liquidprompt"
git clone-pull https://github.com/nojhan/liquidprompt.git ~/.liquidprompt

# Install antigen
installing "~/.antigen"
git clone-pull https://github.com/zsh-users/antigen.git ~/.antigen

# Install oh-my-zsh
installing "~/.oh-my-zsh"
git clone-pull https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh

# Install fzf
installing "~/.fzf"
git clone-pull https://github.com/junegunn/fzf.git ~/.fzf
~/.fzf/install --bin

# Install tmux plugin manager
installing "~/.tmux/plugins/tpm"
git clone-pull https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Ensure environment variables are set
msg "Sourcing environment variables"
source ~/.local/sh/path.sh
source ~/.local/sh/env.sh

# Install sshconfig to manage ~/.ssh/config
if hasnt sshconfig; then
  installing "sshconfig"
  curl -sS suderman.github.io/sshconfig/install | sh
fi
msg "Running sshconfig"
sshconfig

# Update vim bundles
installing "vim bundles"
has vim-update-bundles && vim-update-bundles

msg "...init complete!"

# Run update only if this script is called direct
if [ "$2" != "skip-update" ]; then update "$answer" skip-init; fi

