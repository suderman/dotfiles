#!/bin/bash

# 2015 Jon Suderman
# https://github.com/suderman/dotfiles

# Helper methods for prettier shell scripting - http://suderman.github.io/shelper
eval "$(cat ~/.local/share/shelper.sh || curl suderman.github.io/shelper/shelper.sh)"
updating() { msg "Updating $(cyan "$1")..."; }

# Ask for the administrator password upfront and run a keep-alive to update 
# existing `sudo` time stamp until script has finished
sudo -v
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &


# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀
# ▀▄▀▄▀▄   Bootstrap my system   ▄▀▄▀▄▀
# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀

has git-clone-pull || curl -fsSL suderman.github.io/git-clone-pull/install | sh
has sshconfig      || curl -fsSL suderman.github.io/sshconfig/install | sh


# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀
# ▀▄▀▄▀▄   Update my dotfiles    ▄▀▄▀▄▀
# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀

updating "~/.dotfiles"
git clone-pull https://github.com/suderman/dotfiles.git ~/.dotfiles

msg "Running rcup"
rcup

msg "Running sshconfig"
sshconfig

msg "Updating vim bundles"
~/.vim/bin/vim-update-bundles


# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀
# ▀▄▀▄▀▄   Update shell apps     ▄▀▄▀▄▀
# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀

updating "~/.bash_it"
git clone-pull https://github.com/Bash-it/bash-it.git ~/.bash_it

updating "~/.liquidprompt"
git clone-pull https://github.com/nojhan/liquidprompt.git ~/.liquidprompt

updating "~/.antigen"
git clone-pull https://github.com/zsh-users/antigen.git ~/.antigen

updating "~/.oh-my-zsh"
git clone-pull https://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh

updating "~/.tmux/plugins/tpm"
git clone-pull https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

updating "~/.fzf"
git clone-pull https://github.com/junegunn/fzf.git ~/.fzf
has ~/.fzf/bin/fzf || ~/.fzf/install --bin


# ▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀▄▀

# Run any other tag/host-specific update scripts
for update in ~/bin/update-*; do $update; done
