# ------------------------
# Jon's tmux configuration
# ------------------------

# Set shell to ZSH, check for homebrew version
set -g default-command /bin/zsh 
set -g default-shell /bin/zsh

# set Option-z as the default prefix key combination
# and unbind C-b to free it up
set -g prefix M-z
unbind C-b

# ---------------------
# Copy & Paste
# ---------------------

# use vim keybindings in copy mode
setw -g mode-keys vi
unbind-key -T copy-mode-vi Escape
bind-key -T copy-mode-vi Escape send-keys -X cancel
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi V send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -in -selection clipboard'

# # move between tabs
# bind-key -r C-p select-window -t :-
# bind-key -r C-n select-window -t :+
# 
# # move between tmux sessions
# bind P switch-client -p
# bind N switch-client -n
# bind L switch-client -l

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n M-h if-shell "$is_vim" "send-keys M-h"  "select-pane -L"
bind-key -n M-j if-shell "$is_vim" "send-keys M-j"  "select-pane -D"
bind-key -n M-k if-shell "$is_vim" "send-keys M-k"  "select-pane -U"
bind-key -n M-l if-shell "$is_vim" "send-keys M-l"  "select-pane -R"
# bind-key -n M-\ if-shell "$is_vim" "send-keys M-\\" "select-pane -l"
bind-key -T copy-mode-vi M-h select-pane -L
bind-key -T copy-mode-vi M-j select-pane -D
bind-key -T copy-mode-vi M-k select-pane -U
bind-key -T copy-mode-vi M-l select-pane -R
# bind-key -T copy-mode-vi M-\ select-pane -l

bind-key -n M-u split-window
bind-key -n M-i split-window -h

bind-key -n M-x kill-pane
bind-key -n M-t new-window
bind-key -n M-] select-window -t :+
bind-key -n M-[ select-window -t :-

bind-key -n M-\; command-prompt
bind-key -n M-: command-prompt
bind-key -n M-v copy-mode
bind-key -n M-p paste-buffer

bind-key -nr M-H resize-pane -L
bind-key -nr M-J resize-pane -D
bind-key -nr M-K resize-pane -U
bind-key -nr M-L resize-pane -R

# set window and pane index to 1 ('0' is at the wrong end of the keyboard)
set -g base-index 1
setw -g pane-base-index 1

# Allow mousing
set -g mouse on

# ----------------------
# Set some pretty colors
# ----------------------
#
# set pane colors - hilight the active pane
set -g pane-border-fg colour235 #base02
set -g pane-active-border-fg colour240 #base01

# colorize messages in the command line
set -g message-bg black #base02
set -g message-fg brightred #orange


# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/vim-tmux-focus-events'
set -g @plugin 'jimeh/tmux-themepack'
set -g @themepack 'default/blue'

# Plugin options
set -g @resurrect-strategy-vim 'session'

# Keep this line at the very bottom of tmux.conf
run '~/.tmux/plugins/tpm/tpm'
